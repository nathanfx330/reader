<!-- Save this code in the file named "templates/reader.html" -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Reader</title>
    <style>
        :root {
            --bg-color: #1e1e1e; --text-color: #d4d4d4; --text-muted: #888;
            --link-color: #4fc1ff; --link-hover: #82d4ff; --border-color: #3a3a3a;
            --container-bg: #252526; --code-bg: #1a1a1a; --code-text: #ccc;
            --header-border: #444; --icon-dir: #ffd700; --icon-py: #4ec9b0;
            --icon-html: #d16969; --icon-css: #569cd6; --icon-other: #888;
            --button-bg: #333; --button-hover-bg: #444; --button-active-bg: #555;
            --button-text: #ccc; --error-text: #f48771; --copy-all-bg: #007acc;
            --copy-all-hover: #005fa3; --copy-all-active: #004c8c; --copy-all-text: #fff;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; line-height: 1.6; margin: 0; padding: 20px; background-color: var(--bg-color); color: var(--text-color); }
        .container { background-color: var(--container-bg); padding: 25px; border-radius: 8px; border: 1px solid var(--border-color); max-width: 1200px; margin: auto; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        h1 { color: var(--text-color); border-bottom: 1px solid var(--header-border); padding-bottom: 10px; margin-top: 0; font-size: 1.8em; font-weight: 500; margin-bottom: 25px; }
        .directory-filter { background-color: #2a2a2b; padding: 15px 20px; border-radius: 6px; margin-bottom: 25px; border: 1px solid var(--border-color); }
        .filter-title { margin-top: 0; margin-bottom: 15px; font-size: 1.1em; font-weight: 500; color: var(--text-muted); }
        .directory-list { list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; gap: 10px 20px; }
        .directory-list-item label { display: flex; align-items: center; cursor: pointer; font-size: 0.9em; }
        .dir-checkbox { margin-right: 8px; cursor: pointer; width: 15px; height: 15px; }
        .dir-path { font-family: Consolas, "Courier New", monospace; color: var(--text-color); }
        .file-list { list-style: none; padding: 0; margin: 0; }
        .file-item { padding: 15px 0; border-bottom: 1px solid var(--border-color); }
        .file-item:last-child { border-bottom: none; }
        .item-header { display: flex; align-items: center; margin-bottom: 10px; flex-wrap: wrap; }
        .icon { display: inline-block; width: 25px; text-align: center; margin-right: 12px; font-size: 1.3em; flex-shrink: 0; }
        .py-icon { color: var(--icon-py); } .html-icon { color: var(--icon-html); } .css-icon { color: var(--icon-css); }
        .file-name { font-weight: 600; color: var(--text-color); margin-right: 10px; }
        .copy-button { background-color: var(--button-bg); color: var(--button-text); border: 1px solid var(--border-color); padding: 3px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8em; margin-left: auto; transition: background-color 0.2s ease, color 0.2s ease; flex-shrink: 0; }
        .copy-button:hover { background-color: var(--button-hover-bg); } .copy-button:active { background-color: var(--button-active-bg); } .copy-button.copied { background-color: var(--icon-py); color: var(--bg-color); }
        .code-block-container { margin-top: 5px; border: 1px solid var(--border-color); border-radius: 5px; overflow: hidden; }
        .code-block-prefix { font-family: monospace; font-size: 0.95em; color: var(--text-muted); background-color: #303031; padding: 8px 12px; border-bottom: 1px solid var(--border-color); word-break: break-all; }
        pre { background-color: var(--code-bg); color: var(--text-text); padding: 15px; border-radius: 0 0 4px 4px; margin: 0; overflow-x: auto; white-space: pre; font-family: Consolas, "Courier New", monospace; font-size: 0.9em; line-height: 1.45; }
        pre code { padding: 0; background: none; border: none; font-size: inherit; color: inherit; }
        pre code.error-content { color: var(--error-text); font-style: italic; }
        .copy-all-container { margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--header-border); text-align: center; }
        #copy-all-button { background-color: var(--copy-all-bg); color: var(--copy-all-text); border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 1.1em; font-weight: 500; transition: background-color 0.2s ease; }
        #copy-all-button:hover { background-color: var(--copy-all-hover); } #copy-all-button:active { background-color: var(--copy-all-active); } #copy-all-button.copied { background-color: var(--icon-py); color: var(--bg-color); }
    </style>
</head>
<body>
    <div class="container">
        <h1>Project File Contents</h1>
        <p style="text-align: center; margin-top: -15px; margin-bottom: 20px; color: var(--text-muted);">Base Directory: {{ base_directory }}</p>

        {% if directories %}
        <div class="directory-filter">
            <h3 class="filter-title">Exclude Directories from "Copy All":</h3>
            <ul class="directory-list">
                {% for directory in directories %}
                <li class="directory-list-item">
                    <label>
                        <input type="checkbox" class="dir-checkbox" value="{{ directory }}" checked>
                        <span class="dir-path">{{ directory }}</span>
                    </label>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="copy-all-container">
            <button id="copy-all-button">Copy All Files Structure & Content</button>
        </div>

        {% if files %}
            <ul class="file-list">
                {% for file_info in files %}
                <li class="file-item" data-path="{{ file_info.path }}" data-directory="{{ file_info.directory }}">
                    <div class="item-header">
                        {% if file_info.type == 'python' %}<span class="icon py-icon">üêç</span>
                        {% elif file_info.type == 'html' %}<span class="icon html-icon">üìÑ</span>
                        {% elif file_info.type == 'css' %}<span class="icon css-icon">üé®</span>
                        {% endif %}
                        <span class="file-name">{{ file_info.name }}</span>
                        {% if not file_info.error and file_info.content is not none %}
                            <button class="copy-button" data-target-id="code-{{ file_info.id }}">Copy</button>
                        {% endif %}
                    </div>
                    <div class="code-block-container">
                        <div class="code-block-prefix">{{ file_info.path }}</div>
                        <pre><code id="code-{{ file_info.id }}" class="{{ 'error-content' if file_info.error else '' }}">{{ file_info.content | escape }}</code></pre>
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% else %}
             <p style="text-align: center; margin-top: 30px;"><em>No viewable files found.</em></p>
        {% endif %}
    </div>

    <script>
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('copy-button')) {
                const button = event.target;
                const targetId = button.getAttribute('data-target-id');
                const codeElement = document.getElementById(targetId);
                if (codeElement) {
                    navigator.clipboard.writeText(codeElement.innerText)
                        .then(() => {
                            button.textContent = 'Copied!'; button.classList.add('copied'); button.disabled = true;
                            setTimeout(() => { button.textContent = 'Copy'; button.classList.remove('copied'); button.disabled = false; }, 1500);
                        })
                        .catch(err => {
                            console.error('Failed to copy text: ', err); button.textContent = 'Error';
                            setTimeout(() => { button.textContent = 'Copy'; }, 2000);
                        });
                }
            }
        });

        const copyAllButton = document.getElementById('copy-all-button');
        if (copyAllButton) {
            copyAllButton.addEventListener('click', function() {
                const excludedDirs = new Set();
                document.querySelectorAll('.dir-checkbox:not(:checked)').forEach(checkbox => {
                    excludedDirs.add(checkbox.value);
                });

                let fullTextOutput = "";
                const fileItems = document.querySelectorAll('.file-list .file-item');

                fileItems.forEach(item => {
                    const dirName = item.getAttribute('data-directory');

                    if (excludedDirs.has(dirName)) {
                        return;
                    }

                    const filePath = item.getAttribute('data-path');
                    const codeElement = item.querySelector('pre code');
                    const isError = codeElement ? codeElement.classList.contains('error-content') : true;

                    if (filePath && codeElement && !isError) {
                        const codeContent = codeElement.innerText;
                        fullTextOutput += `--- File: ${filePath} ---\n`;
                        fullTextOutput += `${codeContent}\n\n`;
                    }
                });

                if (fullTextOutput) {
                    navigator.clipboard.writeText(fullTextOutput.trim())
                        .then(() => {
                            const originalText = copyAllButton.textContent;
                            copyAllButton.textContent = 'Copied Selected!'; copyAllButton.classList.add('copied'); copyAllButton.disabled = true;
                            setTimeout(() => { copyAllButton.textContent = 'Copy All Files Structure & Content'; copyAllButton.classList.remove('copied'); copyAllButton.disabled = false; }, 2000);
                        })
                        .catch(err => {
                            console.error('Failed to copy all text: ', err); copyAllButton.textContent = 'Copy All Error!';
                            setTimeout(() => { copyAllButton.textContent = 'Copy All Files Structure & Content'; }, 2500);
                        });
                } else {
                    alert("No content to copy. Check if all directories are excluded or if there are no valid files.");
                }
            });
        }
    </script>
</body>
</html>
